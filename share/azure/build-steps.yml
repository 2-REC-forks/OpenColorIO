parameters:
  - buildTests: 'ON'
  - buildGpuTests: 'OFF'
  - buildDocs: 'ON'
  - cxxFlags: ''

steps:

  - checkout: self
    clean: true
    fetchDepth: 50
    displayName: Checkout OCIO source

  - bash: |
      mkdir _build
      mkdir _install
    displayName: Create working directories

  - bash: |
      cmake .. \
        -DCMAKE_INSTALL_PREFIX=../_install \
        -DCMAKE_BUILD_TYPE=Release \
        -DOCIO_BUILD_TESTS=${{ parameters.buildTests }} \
        -DOCIO_BUILD_GPU_TESTS=${{ parameters.buildGpuTests }} \
        -DOCIO_BUILD_DOCS=${{ parameters.buildDocs }} \
        -DOCIO_WARNING_AS_ERROR=ON \
        -DCMAKE_CXX_FLAGS="${{ parameters.cxxFlags }}"
    workingDirectory: _build
    displayName: Configure OCIO

  - bash: |
      cmake --build . --target install
    workingDirectory: _build
    displayName: Build OCIO

  - bash: |
      ctest -V
    workingDirectory: _build
    displayName: Test OCIO
